"use strict";angular.module("smcApp",["ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("smcApp").controller("MainCtrl",["$scope",function(a){function b(a){w&&(TweenMax.to(".BackVideo",a,{opacity:0,ease:Power0.easeNone,onComplete:i},"miniVideo"),TweenMax.to(".napFace",8,{opacity:.5,ease:Power0.easeNone}),TweenMax.to(".videoClass",1.5,{volume:0,ease:Power0.easeNone}),TweenMax.staggerFrom(y,2,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,1]},ease:Back.easeOut.config(.8)},.5),w=!1)}function c(){m=new THREE.Scene,n=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),n.setSize(s,.1*t),n.setViewport(0,0,s,t),n.getMaxAnisotropy();var a=document.getElementById("car");a.appendChild(n.domElement),l=new THREE.PerspectiveCamera(50,s/t,.1,1e3),l.position.set(0,0,150),d(),p=new THREE.PointLight(16777113,1,300),p.position.set(0,5,60),p.name="luzDireccional",q=new THREE.PointLight(16777215,1,150),q.position.set(0,5,60),q.name="luzFija",m.add(p),m.add(q),window.addEventListener("resize",e,!1)}function d(){var a=new THREE.OBJLoader;a.load("images/models/corvega.obj",function(a){o=a,o.traverse(function(a){a instanceof THREE.Mesh&&("CorvegaConvBody"==a.name&&(a.material.ambient.setHex(16777215),a.material.color.setHex(16777215)),"CorvegaConvGlass"==a.name&&(a.material.ambient.setHex(16777215),a.material.color.setHex(5592524)),"CorvegaConvSeat"==a.name&&(a.material.ambient.setHex(16777215),a.material.color.setHex(13382451)))}),o.rotation.x=1.35,o.rotation.y=1.57,o.scale.set(.6,.6,.5),o.position.set(-35,-60,0),o.name="classicCar",m.add(o)})}function e(){l.aspect=window.innerWidth/window.innerHeight,l.updateProjectionMatrix(),n.setSize(window.innerWidth,.1*window.innerHeight)}function f(){u>0?p.position.x<-300?p.position.x=300:p.position.x=p.position.x-10*r:0>u&&(p.position.x>300?p.position.x=-300:p.position.x=p.position.x+10*r),setTimeout(function(){requestAnimationFrame(f)},1e3/30),g()}function g(){n.render(m,l)}function h(){v?($("#mapIcon").removeClass("mapIconMini"),$(".mapItem").removeClass("mapItemMini"),$("#mapContainer").removeClass("mapaD"),v=!1):($("#mapIcon").addClass("mapIconMini"),$(".mapItem").addClass("mapItemMini"),$("#mapContainer").addClass("mapaD"),v=!0)}function i(){C.play(),$(".BackVideo").css("display","none"),TweenMax.to(C,1,{volume:.5,ease:Power0.easeNone})}function j(){r=0,u=0,D.pause()}function k(a){$("#texto2").append(a),TweenMax.from(a,.3,{opacity:0,y:40,transformOrigin:"0% 50% -50",ease:Power2.easeOut})}var l,m,n,o,p,q,r,s=window.innerWidth,t=window.innerHeight,u=0,v=!0,w=!0,x=($("body"),.01),y=($("#quote").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"introLetters"}),$(".introLetters")),z=($("#cita1").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"cita1Letters"}),$(".cita1Letters")),A=($("#texto1").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"texto1Letters"}),$(".texto1Letters")),B=0,C=new Howl({urls:["audio/ValsViudaAlegre.mp3"],loop:!1,volume:1e-4,onend:function(){console.log("Finished!")}});$(".videoClass").bind("ended",function(){b(4)}),$("#skip").on("click",function(){b(1)}),TweenMax.set(".scrollIcon, .hiddenCanvas, .dinamycText, .ageTitle, .napFace, .addon1",{visibility:"visible"});var D=new TimelineMax({repeat:0});D.to(".back",2,{left:"-100%",ease:Power0.easeNone},"penta").to(".napFace",1.8,{left:"9%",ease:Power0.easeNone},"penta").staggerTo(y,.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1,"penta").staggerTo(".ageTitle",1,{color:"#ffd85f",fontSize:"2em",opacity:1,repeat:1,repeatDelay:2.5,yoyo:!0,ease:Power2.easeOut},2.02,"penta").to(".age1",2,{color:"#ffd85f",fontSize:"2em",opacity:1,ease:Power0.easeNone},"penta").from(".fotoFamily",1.2,{marginLeft:"6%",ease:Power0.easeNone},"penta+=1").to(".fotoFamily",.8,{top:"-70%",ease:Power0.easeNone},"+=1").to(".textIntro",2,{top:"-20%",ease:Power0.easeNone},"-=1").to(".prel01",2,{bottom:"24%",ease:Power2.easeOut},"step2-=1.5").to(".prel02",1.8,{bottom:"62%",ease:Power2.easeOut},"step2-=1.5").to(".prel03",1.6,{bottom:"40%",ease:Power2.easeOut},"step2-=1.5").staggerFrom(z,.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1).staggerTo(".addon1",.5,{opacity:1,scale:1,ease:Back.easeOut},.5).to(".prel01",2,{bottom:"110%",ease:Power2.easeIn},"step3").to(".prel02",1.8,{bottom:"110%",ease:Power2.easeIn},"step3").to(".prel03",1.6,{bottom:"110%",ease:Power2.easeIn},"step3").staggerTo(".addon1",.5,{opacity:0,scale:0,ease:Power2.easeOut},.5).staggerTo(z,.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1,"-=1"),D.pause(),$(window).bind("mousewheel DOMMouseScroll",function(a){a.preventDefault(),"mousedown"!=a.type&&(a.originalEvent.wheelDelta>0||a.originalEvent.detail<0?B>0&&(r=3,u=-1,!v&&.1>B&&h(),B>x?B-=x:x>=B&&(B=0),TweenLite.to(D,.5,{progress:B,ease:Power2.easeOut,onComplete:j})):1>B&&(v&&h(),r=3,u=1,TweenLite.to(D,.5,{progress:B,ease:Power2.easeOut,onComplete:j}),B+=x))}),$("#slider").on("input",function(){v&&h(),r=Math.abs(this.value),D.timeScale(2*r),o.position.x=-35+3*this.value,this.value>=0?(D.play(),u=1):(D.reverse(),u=-1)}),$("#slider").on("mouseup",function(){this.value=0,u=0,o.position.x=-35,D.timeScale(0),D.pause()}),c(),f();var E,s=window.innerWidth/1.5,t=window.innerHeight/2;if(console.log(s),1500>s)var F={leftCenter:-40,upCenter:20,scaleX:300,font:"14px"};else var F={leftCenter:-80,scaleX:400,font:"22px"};var G=d3.geo.mercator().center([F.leftCenter,F.upCenter]).scale(F.scaleX).rotate([0,0]),H=d3.select("#mapContainer").append("svg").attr("width",s).attr("height",t),I=d3.geo.path().projection(G),J=H.append("g");d3.json("images/models/world-110m2.json",function(a,b){d3.csv("images/models/cities.csv",function(a,b){var c=J.selectAll("circle").data(b).enter();E=c.append("circle").attr("cx",function(a){return G([a.lon,a.lat])[0]}).attr("cy",function(a){return G([a.lon,a.lat])[1]}).attr("r",7).attr("id","circulos").style("opacity","0.7").style("fill","rgba(255,255,255,0.2)").style("stroke","#ffd85f").style("stroke-width","2").style("cursor","pointer"),c.append("text").text(function(a){return a.name}).attr("x",function(a){return G([a.lon,a.lat])[0]+1*a.precisionX}).attr("y",function(a){return G([a.lon,a.lat])[1]+1*a.precisionY}).attr("fill","#ffd85f").style("font-size",F.font).style("font-family","'Alice',serif").style("cursor","pointer")}),J.selectAll("path").data(topojson.object(b,b.objects.countries).geometries).enter().append("path").attr("d",I).on("mouseover",function(a){console.log(a)})}),setInterval(function(){E.attr("r",10),E.transition().duration(800).attr("r",1)},1e3),$(document).on("click","#mapIcon, #arrowClose",function(){h()}),$(document).on("click","#texto2",function(){$(".plusInfoCita").text(""),_.each(A,function(a,b){setTimeout(function(){k(a)},10*b)}),$(".minusInfo").css("opacity","1")})}]),angular.module("smcApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);