"use strict";angular.module("smcApp",["ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("smcApp").controller("MainCtrl",["$scope",function(a){function b(a){v&&(TweenMax.to(".BackVideo",a,{opacity:0,ease:Power0.easeNone,onComplete:i},"miniVideo"),TweenMax.to(".napFace",8,{opacity:.5,ease:Power0.easeNone}),TweenMax.to(".videoClass",1.5,{volume:0,ease:Power0.easeNone}),TweenMax.staggerFrom(x,2,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,1]},ease:Back.easeOut.config(.8)},.5),v=!1)}function c(){l=new THREE.Scene,m=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),m.setSize(r,.1*s),m.setViewport(0,0,r,s),m.getMaxAnisotropy();var a=document.getElementById("car");a.appendChild(m.domElement),k=new THREE.PerspectiveCamera(50,r/s,.1,1e3),k.position.set(0,0,150),d(),o=new THREE.PointLight(16777113,1,300),o.position.set(0,5,60),o.name="luzDireccional",p=new THREE.PointLight(16777215,1,150),p.position.set(0,5,60),p.name="luzFija",l.add(o),l.add(p),window.addEventListener("resize",e,!1)}function d(){var a=new THREE.OBJLoader;a.load("images/models/corvega.obj",function(a){n=a,n.traverse(function(a){a instanceof THREE.Mesh&&("CorvegaConvBody"==a.name&&(a.material.ambient.setHex(16777215),a.material.color.setHex(16777215)),"CorvegaConvGlass"==a.name&&(a.material.ambient.setHex(16777215),a.material.color.setHex(5592524)),"CorvegaConvSeat"==a.name&&(a.material.ambient.setHex(16777215),a.material.color.setHex(13382451)))}),n.rotation.x=1.35,n.rotation.y=1.57,n.scale.set(.6,.6,.5),n.position.set(-35,-60,0),n.name="classicCar",l.add(n)})}function e(){k.aspect=window.innerWidth/window.innerHeight,k.updateProjectionMatrix(),m.setSize(window.innerWidth,.1*window.innerHeight)}function f(){t>0?o.position.x<-300?o.position.x=300:o.position.x=o.position.x-10*q:0>t&&(o.position.x>300?o.position.x=-300:o.position.x=o.position.x+10*q),setTimeout(function(){requestAnimationFrame(f)},1e3/30),g()}function g(){m.render(l,k)}function h(){u?($("#mapIcon").removeClass("mapIconMini"),$(".mapItem").removeClass("mapItemMini"),$("#mapContainer").removeClass("mapaD"),u=!1):($("#mapIcon").addClass("mapIconMini"),$(".mapItem").addClass("mapItemMini"),$("#mapContainer").addClass("mapaD"),u=!0)}function i(){B.play(),$(".BackVideo").css("display","none"),TweenMax.to(B,1,{volume:.5,ease:Power0.easeNone})}function j(){q=0,t=0,C.pause()}var k,l,m,n,o,p,q,r=window.innerWidth,s=window.innerHeight,t=0,u=!0,v=!0,w=($("body"),.01),x=($("#quote").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"introLetters"}),$(".introLetters")),y=($("#cita1").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"cita1Letters"}),$(".cita1Letters")),z=($("#texto1").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"texto1Letters"}),$(".texto1Letters")),A=0,B=new Howl({urls:["audio/ValsViudaAlegre.mp3"],loop:!1,volume:1e-4,onend:function(){console.log("Finished!")}});$(".videoClass").bind("ended",function(){b(4)}),$("#skip").on("click",function(){b(1)}),TweenMax.set(".scrollIcon, .hiddenCanvas, .dinamycText, .ageTitle, .napFace, .addon1",{visibility:"visible"});var C=new TimelineMax({repeat:0});C.to(".back",2,{left:"-100%",ease:Power0.easeNone},"penta").to(".napFace",1.8,{left:"9%",ease:Power0.easeNone},"penta").staggerTo(x,.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1,"penta").to(".age1",2,{color:"#ffd85f",fontSize:"2em",opacity:1,ease:Power0.easeNone},"penta").from(".fotoFamily",1.2,{marginLeft:"6%",ease:Power0.easeNone},"penta+=1").to(".fotoFamily",.8,{top:"-70%",ease:Power0.easeNone},"+=1").to(".textIntro",2,{top:"-20%",ease:Power0.easeNone},"-=1").to(".prel01",2,{bottom:"24%",ease:Power2.easeOut},"step2-=1.5").to(".prel02",1.8,{bottom:"62%",ease:Power2.easeOut},"step2-=1.5").to(".prel03",1.6,{bottom:"40%",ease:Power2.easeOut},"step2-=1.5").staggerFrom(y,.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1).staggerFrom(z,.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1).staggerTo(".addon1",.5,{opacity:1,scale:1,ease:Back.easeOut},.5).to(".prel01",2,{bottom:"110%",ease:Power2.easeIn},"step3").to(".prel02",1.8,{bottom:"110%",ease:Power2.easeIn},"step3").to(".prel03",1.6,{bottom:"110%",ease:Power2.easeIn},"step3").staggerTo(".addon1",.5,{opacity:0,scale:0,ease:Power2.easeOut},.5).staggerTo(y,.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1,"-=1").staggerTo(z,.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1,"-=1"),C.pause(),$(window).bind("mousewheel DOMMouseScroll",function(a){a.preventDefault(),"mousedown"!=a.type&&(a.originalEvent.wheelDelta>0||a.originalEvent.detail<0?A>0&&(q=3,t=-1,!u&&.1>A&&h(),A>w?A-=w:w>=A&&(A=0),TweenLite.to(C,.5,{progress:A,ease:Power2.easeOut,onComplete:j})):1>A&&(u&&h(),q=3,t=1,TweenLite.to(C,.5,{progress:A,ease:Power2.easeOut,onComplete:j}),A+=w))}),$("#slider").on("input",function(){u&&h(),q=Math.abs(this.value),C.timeScale(2*q),n.position.x=-35+3*this.value,this.value>=0?(C.play(),t=1):(C.reverse(),t=-1)}),$("#slider").on("mouseup",function(){this.value=0,t=0,n.position.x=-35,C.timeScale(0),C.pause()}),c(),f();var D,r=window.innerWidth/1.5,s=window.innerHeight/2;if(console.log(r),1500>r)var E={leftCenter:-40,upCenter:20,scaleX:300,font:"14px"};else var E={leftCenter:-80,scaleX:400,font:"22px"};var F=d3.geo.mercator().center([E.leftCenter,E.upCenter]).scale(E.scaleX).rotate([0,0]),G=d3.select("#mapContainer").append("svg").attr("width",r).attr("height",s),H=d3.geo.path().projection(F),I=G.append("g");d3.json("images/models/world-110m2.json",function(a,b){d3.csv("images/models/cities.csv",function(a,b){var c=I.selectAll("circle").data(b).enter();D=c.append("circle").attr("cx",function(a){return F([a.lon,a.lat])[0]}).attr("cy",function(a){return F([a.lon,a.lat])[1]}).attr("r",7).attr("id","circulos").style("opacity","0.7").style("fill","rgba(255,255,255,0.2)").style("stroke","#ffd85f").style("stroke-width","2").style("cursor","pointer"),c.append("text").text(function(a){return a.name}).attr("x",function(a){return F([a.lon,a.lat])[0]+1*a.precisionX}).attr("y",function(a){return F([a.lon,a.lat])[1]+1*a.precisionY}).attr("fill","#ffd85f").style("font-size",E.font).style("font-family","'Alice',serif").style("cursor","pointer")}),I.selectAll("path").data(topojson.object(b,b.objects.countries).geometries).enter().append("path").attr("d",H).on("mouseover",function(a){console.log(a)})}),setInterval(function(){D.attr("r",10),D.transition().duration(800).attr("r",1)},1e3),$(document).on("click","#mapIcon, #arrowClose",function(){h()})}]),angular.module("smcApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);