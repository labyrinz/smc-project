"use strict";angular.module("smcApp",["ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("smcApp").controller("MainCtrl",["$scope",function(a){function b(){y&&(H.drawsvg("animate"),G.play(),M.play(),y=!1)}function c(){o=new THREE.Scene,p=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),p.setSize(u,.1*v),p.setViewport(0,0,u,v),p.getMaxAnisotropy();var a=document.getElementById("car");a.appendChild(p.domElement),n=new THREE.PerspectiveCamera(50,u/v,.1,1e3),n.position.set(0,0,150),d(),r=new THREE.PointLight(16777113,1,300),r.position.set(0,5,60),r.name="luzDireccional",s=new THREE.PointLight(16777215,1,150),s.position.set(0,5,60),s.name="luzFija",o.add(r),o.add(s),window.addEventListener("resize",e,!1)}function d(){var a=new THREE.OBJLoader;a.load("images/models/corvega.obj",function(a){q=a,q.traverse(function(a){a instanceof THREE.Mesh&&("CorvegaConvBody"==a.name&&(a.material.ambient.setHex(16777215),a.material.color.setHex(16777215)),"CorvegaConvGlass"==a.name&&(a.material.ambient.setHex(16777215),a.material.color.setHex(5592524)),"CorvegaConvSeat"==a.name&&(a.material.ambient.setHex(16777215),a.material.color.setHex(13382451)))}),q.rotation.x=1.35,q.rotation.y=1.57,q.scale.set(.6,.6,.5),q.position.set(-35,-60,0),q.name="classicCar",o.add(q)})}function e(){n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),p.setSize(window.innerWidth,.1*window.innerHeight)}function f(){w>0?r.position.x<-300?r.position.x=300:r.position.x=r.position.x-10*t:0>w&&(r.position.x>300?r.position.x=-300:r.position.x=r.position.x+10*t),setTimeout(function(){requestAnimationFrame(f)},1e3/30),g()}function g(){p.render(o,n)}function h(a){void 0==a?x?($("#mapIcon").removeClass("mapIconMini"),$(".mapItem").removeClass("mapItemMini"),$("#mapContainer").removeClass("mapaD"),x=!1):($("#mapIcon").addClass("mapIconMini"),$(".mapItem").addClass("mapItemMini"),$("#mapContainer").addClass("mapaD"),x=!0):a?($("#mapIcon").addClass("mapIconMini"),$(".mapItem").addClass("mapItemMini"),$("#mapContainer").addClass("mapaD"),x=!0):a||($("#mapIcon").removeClass("mapIconMini"),$(".mapItem").removeClass("mapItemMini"),$("#mapContainer").removeClass("mapaD"),x=!1)}function i(){$(".BackVideo").css("display","none")}function j(){t=0,w=0,M.pause()}function k(a,b){$("#cita"+b+"suma").append(a),TweenMax.from(a,.5,{opacity:0,y:-40,transformOrigin:"0% 50% -50",ease:Power2.easeOut})}function l(a){$(a).remove()}function m(){I.drawsvg("animate")}var n,o,p,q,r,s,t,u=window.innerWidth,v=window.innerHeight,w=0,x=!1,y=!0,z=($("body"),.01),A=[],B=($("#quote").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"introLetters"}),$(".introLetters"));$("#cita1").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"cita1Letters"});A[0]=$(".cita1Letters");$("#cita2").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"cita2Letters"});A[1]=$(".cita2Letters");$("#cita3").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"cita3Letters"});A[2]=$(".cita3Letters");$("#cita4").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"cita4Letters"});A[3]=$(".cita4Letters");$("#cita5").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"cita5Letters"});A[4]=$(".cita5Letters");$("#cita6").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"cita6Letters"});A[5]=$(".cita6Letters");$("#cita7").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"cita7Letters"});A[6]=$(".cita7Letters");var C=($("#texto1").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"texto1Letters"}),$(".texto1Letters")),D=($("#texto2").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"texto2Letters"}),$(".texto2Letters")),E=($("#texto3").splitText({type:"words",animation:"glowOnHover",useLite:!0,addClass:"texto3Letters"}),$(".texto3Letters")),F=0,G=new Howl({urls:["audio/ValsViudaAlegre.mp3"],loop:!1,volume:.5,onend:function(){console.log("Finished!")}}),H=$("#FirstFace").drawsvg({duration:3e3,easing:"linear",callback:function(){console.log("dibujo terminado")}}),I=$("#viaje1Svg").drawsvg({duration:8e3,easing:"linear",callback:function(){console.log("dibujo terminado")}});$(".videoClass").bind("ended",function(){b()}),$("#skip").on("click",function(){b()});var J=[0,0,60,0,35,100,0,100],K=[90,0,90,0,90,100,90,100],L=[56,0,90,0,90,100,43,100];TweenMax.to(".openBook",.5,{right:"4%",repeatDelay:.1,repeat:-1,yoyo:!0,ease:Power2.easeOut}),K.onUpdate=function(){TweenMax.set(".prel01",{webkitClipPath:"polygon("+J[0]+"%"+J[1]+"%,"+J[2]+"%"+J[3]+"%,"+J[4]+"%"+J[5]+"%,"+J[6]+"%"+J[7]+"%)"}),TweenMax.set(".prelGroup",{webkitClipPath:"polygon("+L[0]+"%"+L[1]+"%,"+L[2]+"%"+L[3]+"%,"+L[4]+"%"+L[5]+"%,"+L[6]+"%"+L[7]+"%)"})},TweenMax.set(".scrollIcon, .hiddenCanvas, .dinamycText, .ageTitle, .napFace, .addon1, .prel01",{visibility:"visible"});var M=new TimelineMax({repeat:0});M.to(".videoClass",.2,{scale:0,ease:Power0.easeNone}).to(".BackVideo",.2,{opacity:0,onComplete:i,ease:Power0.easeNone},"-=0.1").to(".videoClass",.5,{volume:0,ease:Power0.easeNone}).to("#page0",.4,{right:"0%",ease:Power0.easeNone}).staggerFrom(B,.1,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.2]},ease:Back.easeOut.config(.8)},.1).to(".instructions",.2,{opacity:1,repeat:6,repeatDelay:.1,yoyo:!0,ease:Power0.easeNone}).to("#page0",.4,{right:"110%",ease:Power0.easeNone}).to("#page1",.4,{right:"0%",ease:Power0.easeNone},"-=0.5").staggerFrom(C,.1,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.2],ease:Back.easeOut.config(.8)}},.1).to(".age1",2,{color:"#ffd85f",fontSize:"2em",opacity:1,ease:Power0.easeNone},"penta").to("#page1",.4,{right:"110%",ease:Power0.easeNone}).to("#page2",.4,{right:"0%",ease:Power0.easeNone},"-=0.5").staggerTo(".cita",.3,{scale:1,ease:Back.easeOut},.1).staggerFrom(A[0],.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1).staggerTo(".addon1",.3,{opacity:.6,scale:1,ease:Back.easeOut},.2).to(J,1,K,"step3").to(L,1,K,"step3").staggerFrom(D,.1,{opacity:0,scale:5,y:200,x:200,transformOrigin:"0% 50% -50",delay:.01,ease:Power2.easeOut},.01).to(".cita01",.5,{scale:0,ease:Back.easeOut}).staggerTo(".addon1",.5,{opacity:0,scale:0,ease:Power2.easeOut},.5).staggerTo(".texto2",.3,{opacity:0,ease:Power2.easeOut}).staggerFrom(E,1,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Back.easeOut.config(1.7)}},.1).from(".mapSvgClassTop",1,{scale:0,onComplete:m,ease:Back.easeOut},"-=6").to(".mapSvgClassTop",4,{width:"250%",top:"-50%",left:"-25%",ease:Power2.easeIn},"-=3").to(".mapSvgClassTop",2,{width:"800%",top:"-370%",left:"-140%",ease:Power2.easeIn}).to(".gironaMap",2,{opacity:0,ease:Power2.easeOut},"-=7").staggerTo(A[0],.5,{opacity:0,cycle:{scale:[0,5],y:[-50,200],x:[-50,200],transformOrigin:"0% 50% -50",delay:[0,.5],ease:Power2.easeOut}},.1,"-=1").to("#page2",.4,{right:"110%",ease:Power0.easeNone}).to("#page3",.4,{right:"0%",ease:Power0.easeNone},"-=0.5").staggerTo(".addon2",.5,{opacity:.6,scale:1,ease:Power2.easeOut},.5),M.pause(),$(window).bind("mousewheel DOMMouseScroll",function(a){a.preventDefault(),"mousedown"!=a.type&&(a.originalEvent.wheelDelta>0||a.originalEvent.detail<0?F>0&&(t=3,w=-1,F>z?F-=z:z>=F&&(F=0),TweenLite.to(M,.5,{progress:F,ease:Power2.easeOut,onComplete:j})):1>F&&(t=3,w=1,TweenLite.to(M,.5,{progress:F,ease:Power2.easeOut,onComplete:j}),F+=z))}),$("#slider").on("input",function(){x&&h(),t=Math.abs(this.value),M.timeScale(2*t),q.position.x=-35+3*this.value,this.value>=0?(M.play(),w=1):(M.reverse(),w=-1)}),$("#slider").on("mouseup",function(){this.value=0,w=0,q.position.x=-35,M.timeScale(0),M.pause()}),c(),f();var N,u=window.innerWidth/1.5,v=window.innerHeight/2;if(1500>u)var O={leftCenter:-40,upCenter:20,scaleX:300,font:"14px"};else var O={leftCenter:-80,scaleX:400,font:"22px"};var P=d3.geo.mercator().center([O.leftCenter,O.upCenter]).scale(O.scaleX).rotate([0,0]),Q=d3.select("#mapContainer").append("svg").attr("width",u).attr("height",v),R=d3.geo.path().projection(P),S=Q.append("g");d3.json("images/models/world-110m2.json",function(a,b){d3.csv("images/models/cities.csv",function(a,b){var c=S.selectAll("circle").data(b).enter();N=c.append("circle").attr("cx",function(a){return P([a.lon,a.lat])[0]}).attr("cy",function(a){return P([a.lon,a.lat])[1]}).attr("r",7).attr("id","circulos").style("opacity","0.7").style("fill","rgba(255,255,255,0.2)").style("stroke","#ffd85f").style("stroke-width","2").style("cursor","pointer"),c.append("text").text(function(a){return a.name}).attr("x",function(a){return P([a.lon,a.lat])[0]+1*a.precisionX}).attr("y",function(a){return P([a.lon,a.lat])[1]+1*a.precisionY}).attr("fill","#ffd85f").style("font-size",O.font).style("font-family","'Alice',serif").style("cursor","pointer")}),S.selectAll("path").data(topojson.object(b,b.objects.countries).geometries).enter().append("path").attr("d",R).attr("stroke","#ffd85f").attr("stroke-width","0.5px").attr("fill","#56481e").on("mouseover",function(a){console.log(a)})}),setInterval(function(){N.attr("r",10),N.transition().duration(800).attr("r",1)},1e3),$(document).on("click","#mapIcon, #arrowClose",function(){h()}),$(document).on("click",".plusInfoCita",function(){var a=$(this).attr("value");"[+]"==$(this).text()?($(this).text("[-]"),_.each(A[parseInt(a)],function(b,c){setTimeout(function(){k(b,a)},40*c)})):($(this).text("[+]"),_.each($("#cita"+a+"suma").children(),function(a,b){setTimeout(function(){l(a)},5*b)}))})}]),angular.module("smcApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);